/**
 ** @author idreamsoft <idreamsoft@qq.com>
 ** @url https://github.com/idreamsoft
 ** @version v6.2.0
 **/
(function($){

function require(e){var _=__modules__[e],r="exports";return"object"==typeof _?_:(_[r]||(_[r]={},_[r]=_.call(_[r],require,_[r],_)||_[r]),_[r])}function define(e,_){__modules__[e]=_}var __modules__={};
define("config",{API:"/api.php",UHOME:"/{uid}/",PUBLIC:"/public/",COOKIE:"iCMS_",AUTH:"USER_AUTH",DIALOG:[],APP:"iCMS"});
define("cookie",{set:function(e,o,n,i,t,c){var u=new Date;u.setTime(u.getTime()+n),e=iCMS.CONFIG.COOKIE+"_"+e,document.cookie=escape(e)+"="+escape(o)+(u?"; expires="+u.toGMTString():"")+(i?"; path="+i:"/")+(t?"; domain="+t:"")+(c?"; secure":"")},get:function(e){e=iCMS.CONFIG.COOKIE+"_"+e;var o=document.cookie.indexOf(e),n=document.cookie.indexOf(";",o);return o==-1?"":unescape(document.cookie.substring(o+e.length+1,n>o?n:document.cookie.length))}});
define("api",{url:function(r,t){return iCMS.CONFIG.API+"?app="+r+(t||"")},param:function(r){var t=$(r),a=t.parent(),n=this.get_param(t),e=this.get_param(a);return $.extend(n,e)},get_param:function(r,t){var a=function(r){var t=[],n=function(r){return"object"==typeof r&&null!=r?a(r):/^(string|number)$/.test(typeof r)?'"'+r+'"':r};for(var e in r)t.push('"'+e+'":'+n(r[e]));return"{"+t.join(",")+"}"};if(t)return void r.attr("data-param",a(t));var t=r.attr("data-param")||!1;return t?$.parseJSON(t):{}}});
define("artdialog",function(){function t(t,e){t=iCMS.CONFIG.PUBLIC+"/"+t;var i=document.createElement("link"),o=document.getElementsByTagName("head")[0];i.id=e,i.href=t,i.type="text/css",i.rel="stylesheet",o.insertBefore(i,o.firstChild)}return t("js/libs/artDialog/ui-dialog.css","ui_dialog_css"),!function(){function t(e){var o=i[e],n="exports";return"object"==typeof o?o:(o[n]||(o[n]={},o[n]=o.call(o[n],t,o[n],o)||o[n]),o[n])}function e(t,e){i[t]=e}var i={};e("jquery",function(){return jQuery}),e("popup",function(t){function e(){this.destroyed=!1,this.__popup=i("<div />").css({display:"none",position:"absolute",outline:0}).attr("tabindex","-1").html(this.innerHTML).appendTo("body"),this.__backdrop=this.__mask=i("<div />").css({opacity:.7,background:"#000"}),this.node=this.__popup[0],this.backdrop=this.__backdrop[0],o++}var i=t("jquery"),o=0,n=!("minWidth"in i("html")[0].style),s=!n;return i.extend(e.prototype,{node:null,backdrop:null,fixed:!1,destroyed:!0,open:!1,returnValue:"",autofocus:!0,align:"bottom left",innerHTML:"",className:"ui-popup",show:function(t){if(this.destroyed)return this;var o=this.__popup,r=this.__backdrop;if(this.__activeElement=this.__getActive(),this.open=!0,this.follow=t||this.follow,!this.__ready){if(o.addClass(this.className).attr("role",this.modal?"alertdialog":"dialog").css("position",this.fixed?"fixed":"absolute"),n||i(window).on("resize",i.proxy(this.reset,this)),this.modal){var a={position:"fixed",left:0,top:0,width:"100%",height:"100%",overflow:"hidden",userSelect:"none",zIndex:this.zIndex||e.zIndex};o.addClass(this.className+"-modal"),s||i.extend(a,{position:"absolute",width:i(window).width()+"px",height:i(document).height()+"px"}),r.css(a).attr({tabindex:"0"}).on("focus",i.proxy(this.focus,this)),this.__mask=r.clone(!0).attr("style","").insertAfter(o),r.addClass(this.className+"-backdrop").insertBefore(o),this.__ready=!0}o.html()||o.html(this.innerHTML)}return o.addClass(this.className+"-show").show(),r.show(),this.reset().focus(),this.__dispatchEvent("show"),this},showModal:function(){return this.modal=!0,this.show.apply(this,arguments)},close:function(t){return!this.destroyed&&this.open&&(void 0!==t&&(this.returnValue=t),this.__popup.hide().removeClass(this.className+"-show"),this.__backdrop.hide(),this.open=!1,this.blur(),this.__dispatchEvent("close")),this},remove:function(){if(this.destroyed)return this;this.__dispatchEvent("beforeremove"),e.current===this&&(e.current=null),this.__popup.remove(),this.__backdrop.remove(),this.__mask.remove(),n||i(window).off("resize",this.reset),this.__dispatchEvent("remove");for(var t in this)delete this[t];return this},reset:function(){var t=this.follow;return t?this.__follow(t):this.__center(),this.__dispatchEvent("reset"),this},focus:function(){var t=this.node,o=this.__popup,n=e.current,s=this.zIndex=e.zIndex++;if(n&&n!==this&&n.blur(!1),!i.contains(t,this.__getActive())){var r=o.find("[autofocus]")[0];!this._autofocus&&r?this._autofocus=!0:r=t,this.__focus(r)}return o.css("zIndex",s),e.current=this,o.addClass(this.className+"-focus"),this.__dispatchEvent("focus"),this},blur:function(){var t=this.__activeElement,e=arguments[0];return e!==!1&&this.__focus(t),this._autofocus=!1,this.__popup.removeClass(this.className+"-focus"),this.__dispatchEvent("blur"),this},addEventListener:function(t,e){return this.__getEventListener(t).push(e),this},removeEventListener:function(t,e){for(var i=this.__getEventListener(t),o=0;o<i.length;o++)e===i[o]&&i.splice(o--,1);return this},__getEventListener:function(t){var e=this.__listener;return e||(e=this.__listener={}),e[t]||(e[t]=[]),e[t]},__dispatchEvent:function(t){var e=this.__getEventListener(t);this["on"+t]&&this["on"+t]();for(var i=0;i<e.length;i++)e[i].call(this)},__focus:function(t){try{this.autofocus&&!/^iframe$/i.test(t.nodeName)&&t.focus()}catch(e){}},__getActive:function(){try{var t=document.activeElement,e=t.contentDocument,i=e&&e.activeElement||t;return i}catch(o){}},__center:function(){var t=this.__popup,e=i(window),o=i(document),n=this.fixed,s=n?0:o.scrollLeft(),r=n?0:o.scrollTop(),a=e.width(),c=e.height(),l=t.width(),h=t.height(),d=(a-l)/2+s,u=382*(c-h)/1e3+r,f=t[0].style;f.left=Math.max(parseInt(d),s)+"px",f.top=Math.max(parseInt(u),r)+"px"},__follow:function(t){var e=t.parentNode&&i(t),o=this.__popup;if(this.__followSkin&&o.removeClass(this.__followSkin),e){var n=e.offset();if(n.left*n.top<0)return this.__center()}var s=this,r=this.fixed,a=i(window),c=i(document),l=a.width(),h=a.height(),d=c.scrollLeft(),u=c.scrollTop(),f=o.width(),p=o.height(),v=e?e.outerWidth():0,_=e?e.outerHeight():0,g=this.__offset(t),m=g.left,b=g.top,y=r?m-d:m,w=r?b-u:b,k=r?0:d,x=r?0:u,E=k+l-f,C=x+h-p,L={},N=this.align.split(" "),T=this.className+"-",$={top:"bottom",bottom:"top",left:"right",right:"left"},I={top:"top",bottom:"top",left:"left",right:"left"},M=[{top:w-p,bottom:w+_,left:y-f,right:y+v},{top:w,bottom:w-p+_,left:y,right:y-f+v}],j={left:y+v/2-f/2,top:w+_/2-p/2},z={left:[k,E],top:[x,C]};i.each(N,function(t,e){M[t][e]>z[I[e]][1]&&(e=N[t]=$[e]),M[t][e]<z[I[e]][0]&&(N[t]=$[e])}),N[1]||(I[N[1]]="left"===I[N[0]]?"top":"left",M[1][N[1]]=j[I[N[1]]]),T+=N.join("-")+" "+this.className+"-follow",s.__followSkin=T,e&&o.addClass(T),L[I[N[0]]]=parseInt(M[0][N[0]]),L[I[N[1]]]=parseInt(M[1][N[1]]),o.css(L)},__offset:function(t){var e=t.parentNode,o=e?i(t).offset():{left:t.pageX,top:t.pageY};t=e?t:t.target;var n=t.ownerDocument,s=n.defaultView||n.parentWindow;if(s==window)return o;var r=s.frameElement,a=i(n),c=a.scrollLeft(),l=a.scrollTop(),h=i(r).offset(),d=h.left,u=h.top;return{left:o.left+d-c,top:o.top+u-l}}}),e.zIndex=1024,e.current=null,e}),e("dialog-config",{backdropBackground:"#000",backdropOpacity:.7,content:'<span class="ui-dialog-loading">Loading..</span>',title:"",statusbar:"",button:null,ok:null,cancel:null,okValue:"ok",cancelValue:"cancel",cancelDisplay:!0,width:"",height:"",padding:"",skin:"",quickClose:!1,cssUri:"../css/ui-dialog.css",innerHTML:'<div i="dialog" class="ui-dialog"><div class="ui-dialog-arrow-a"></div><div class="ui-dialog-arrow-b"></div><table class="ui-dialog-grid"><tr><td i="header" class="ui-dialog-header"><button i="close" class="ui-dialog-close">&#215;</button><div i="title" class="ui-dialog-title"></div></td></tr><tr><td i="body" class="ui-dialog-body"><div i="content" class="ui-dialog-content"></div></td></tr><tr><td i="footer" class="ui-dialog-footer"><div i="statusbar" class="ui-dialog-statusbar"></div><div i="button" class="ui-dialog-button"></div></td></tr></table></div>'}),e("dialog",function(t){var e=t("jquery"),i=t("popup"),o=t("dialog-config"),n=o.cssUri;if(n){var s=t[t.toUrl?"toUrl":"resolve"];s&&(n=s(n),n='<link rel="stylesheet" href="'+n+'" />',e("base")[0]?e("base").before(n):e("head").append(n))}var r=0,a=new Date-0,c=!("minWidth"in e("html")[0].style),l="createTouch"in document&&!("onmousemove"in document)||/(iPhone|iPad|iPod)/i.test(navigator.userAgent),h=!c&&!l,d=function(t,i,o){var n=t=t||{};("string"==typeof t||1===t.nodeType)&&(t={content:t,fixed:!l}),t=e.extend(!0,{},d.defaults,t),t.original=n;var s=t.id=t.id||a+r,c=d.get(s);return c?c.focus():(h||(t.fixed=!1),t.quickClose&&(t.modal=!0),e.isArray(t.button)||(t.button=[]),void 0!==o&&(t.cancel=o),t.cancel&&t.button.push({id:"cancel",value:t.cancelValue,callback:t.cancel,display:t.cancelDisplay}),void 0!==i&&(t.ok=i),t.ok&&t.button.push({id:"ok",value:t.okValue,callback:t.ok,autofocus:!0}),d.list[s]=new d.create(t))},u=function(){};u.prototype=i.prototype;var f=d.prototype=new u;return d.create=function(t){var o=this;e.extend(this,new i);var n=(t.original,e(this.node).html(t.innerHTML)),s=e(this.backdrop);return this.options=t,this._popup=n,e.each(t,function(t,e){"function"==typeof o[t]?o[t](e):o[t]=e}),t.zIndex&&(i.zIndex=t.zIndex),n.attr({"aria-labelledby":this._$("title").attr("id","title:"+this.id).attr("id"),"aria-describedby":this._$("content").attr("id","content:"+this.id).attr("id")}),this._$("close").css("display",this.cancel===!1?"none":"").attr("title",this.cancelValue).on("click",function(t){o._trigger("cancel"),t.preventDefault()}),this._$("dialog").addClass(this.skin),this._$("body").css("padding",this.padding),t.quickClose&&s.on("onmousedown"in document?"mousedown":"click",function(){return o._trigger("cancel"),!1}),this.addEventListener("show",function(){s.css({opacity:0,background:t.backdropBackground}).animate({opacity:t.backdropOpacity},150)}),this._esc=function(t){var e=t.target,n=e.nodeName,s=/^input|textarea$/i,r=i.current===o,a=t.keyCode;!r||s.test(n)&&"button"!==e.type||27===a&&o._trigger("cancel")},e(document).on("keydown",this._esc),this.addEventListener("remove",function(){e(document).off("keydown",this._esc),delete d.list[this.id]}),r++,d.oncreate(this),this},d.create.prototype=f,e.extend(f,{content:function(t){var i=this._$("content");return"object"==typeof t?(t=e(t),i.empty("").append(t.show()),this.addEventListener("remove",function(){e("body").append(t.hide())})):i.html(t),this.reset()},title:function(t){return this._$("title").text(t),this._$("header")[t?"show":"hide"](),this},width:function(t){return this._$("content").css("width",t),this.reset()},height:function(t){return this._$("content").css("height",t),this.reset()},button:function(t){t=t||[];var i=this,o="",n=0;return this.callbacks={},"string"==typeof t?(o=t,n++):e.each(t,function(t,s){var r=s.id=s.id||s.value,a="";i.callbacks[r]=s.callback,s.display===!1?a=' style="display:none"':n++,o+='<button type="button" i-id="'+r+'"'+a+(s.disabled?" disabled":"")+(s.autofocus?' autofocus class="ui-dialog-autofocus"':"")+">"+s.value+"</button>",i._$("button").on("click","[i-id="+r+"]",function(t){var o=e(this);o.attr("disabled")||i._trigger(r),t.preventDefault()})}),this._$("button").html(o),this._$("footer")[n?"show":"hide"](),this},statusbar:function(t){return this._$("statusbar").html(t)[t?"show":"hide"](),this},_$:function(t){return this._popup.find("[i="+t+"]")},_trigger:function(t){var e=this.callbacks[t];return"function"!=typeof e||e.call(this)!==!1?this.close().remove():this}}),d.oncreate=e.noop,d.getCurrent=function(){return i.current},d.get=function(t){return void 0===t?d.list:d.list[t]},d.list={},d.defaults=o,d}),e("drag",function(t){var e=t("jquery"),i=e(window),o=e(document),n="createTouch"in document,s=document.documentElement,r=!("minWidth"in s.style),a=!r&&"onlosecapture"in s,c="setCapture"in s,l={start:n?"touchstart":"mousedown",over:n?"touchmove":"mousemove",end:n?"touchend":"mouseup"},h=n?function(t){return t.touches||(t=t.originalEvent.touches.item(0)),t}:function(t){return t},d=function(){this.start=e.proxy(this.start,this),this.over=e.proxy(this.over,this),this.end=e.proxy(this.end,this),this.onstart=this.onover=this.onend=e.noop};return d.types=l,d.prototype={start:function(t){return t=this.startFix(t),o.on(l.over,this.over).on(l.end,this.end),this.onstart(t),!1},over:function(t){return t=this.overFix(t),this.onover(t),!1},end:function(t){return t=this.endFix(t),o.off(l.over,this.over).off(l.end,this.end),this.onend(t),!1},startFix:function(t){return t=h(t),this.target=e(t.target),this.selectstart=function(){return!1},o.on("selectstart",this.selectstart).on("dblclick",this.end),a?this.target.on("losecapture",this.end):i.on("blur",this.end),c&&this.target[0].setCapture(),t},overFix:function(t){return t=h(t)},endFix:function(t){return t=h(t),o.off("selectstart",this.selectstart).off("dblclick",this.end),a?this.target.off("losecapture",this.end):i.off("blur",this.end),c&&this.target[0].releaseCapture(),t}},d.create=function(t,n){var s,r,a,c,l=e(t),h=new d,u=d.types.start,f=function(){},p=t.className.replace(/^\s|\s.*/g,"")+"-drag-start",v={onstart:f,onover:f,onend:f,off:function(){l.off(u,h.start)}};return h.onstart=function(e){var n="fixed"===l.css("position"),h=o.scrollLeft(),d=o.scrollTop(),u=l.width(),f=l.height();s=0,r=0,a=n?i.width()-u+s:o.width()-u,c=n?i.height()-f+r:o.height()-f;var _=l.offset(),g=this.startLeft=n?_.left-h:_.left,m=this.startTop=n?_.top-d:_.top;this.clientX=e.clientX,this.clientY=e.clientY,l.addClass(p),v.onstart.call(t,e,g,m)},h.onover=function(e){var i=e.clientX-this.clientX+this.startLeft,o=e.clientY-this.clientY+this.startTop,n=l[0].style;i=Math.max(s,Math.min(a,i)),o=Math.max(r,Math.min(c,o)),n.left=i+"px",n.top=o+"px",v.onover.call(t,e,i,o)},h.onend=function(e){var i=l.position(),o=i.left,n=i.top;l.removeClass(p),v.onend.call(t,e,o,n)},h.off=function(){l.off(u,h.start)},n?h.start(n):l.on(u,h.start),v},d}),e("dialog-plus",function(t){var e=t("jquery"),i=t("dialog"),o=t("drag");return i.oncreate=function(t){var i,n=t.options,s=n.original,r=n.url,a=n.oniframeload;if(r&&(this.padding=n.padding=0,i=e("<iframe />"),i.attr({src:r,name:t.id,width:"100%",height:"100%",allowtransparency:"yes",frameborder:"no",scrolling:"no"}).on("load",function(){var e;try{e=i[0].contentWindow.frameElement}catch(o){}e&&(n.width||t.width(i.contents().width()),n.height||t.height(i.contents().height())),a&&a.call(t)}),t.addEventListener("beforeremove",function(){i.attr("src","about:blank").remove()},!1),t.content(i[0]),t.iframeNode=i[0]),!(s instanceof Object))for(var c=function(){t.close().remove()},l=0;l<frames.length;l++)try{if(s instanceof frames[l].Object){e(frames[l]).one("unload",c);break}}catch(h){}e(t.node).on(o.types.start,"[i=title]",function(e){t.follow||(t.focus(),o.create(t.node,e))})},i.get=function(t){if(t&&t.frameElement){var e,o=t.frameElement,n=i.list;for(var s in n)if(e=n[s],e.node.getElementsByTagName("iframe")[0]===o)return e}else if(t)return i.list[t]},i}),window.dialog=t("dialog-plus")}(),dialog});
define("poshytip",function(t){function i(){$.each(s,function(){this.refresh(!0)})}var s=[],e=!!window.createPopup;e&&"undefined"==typeof document.documentElement.currentStyle.minWidth,e&&!document.defaultView;$(window).resize(i),$.Poshytip=function(t,i){this.$elm=$(t),this.opts=$.extend({},$.fn.poshytip.defaults,i);var s=""!=this.opts.idName?"id="+this.opts.idName:"";this.$tip=$(["<div ",s,' class="',this.opts.className,' popover">','<div class="arrow"></div>','<div class="popover-content"></div>',"</div>"].join("")),this.$inner=this.$tip.find("div.popover-content"),this.disabled=!1,this.content=null,this.init()},$.Poshytip.hideAll=function(){$.each(s,function(){this.hide()})},$.Poshytip.prototype={init:function(){s.push(this);var t=this.$elm.attr("title");if(this.$elm.data("title.poshytip",void 0!==t?t:null).data("poshytip",this),"none"!=this.opts.showOn)switch(this.$elm.bind({"mouseenter.poshytip":$.proxy(this.mouseenter,this),"mouseleave.poshytip":$.proxy(this.mouseleave,this)}),this.opts.showOn){case"hover":"cursor"==this.opts.alignTo&&this.$elm.bind("mousemove.poshytip",$.proxy(this.mousemove,this)),this.opts.allowTipHover&&this.$tip.hover($.proxy(this.clearTimeouts,this),$.proxy(this.mouseleave,this));break;case"focus":this.$elm.bind({"focus.poshytip":$.proxy(this.showDelayed,this),"blur.poshytip":$.proxy(this.hideDelayed,this)})}},mouseenter:function(t){return!!this.disabled||(this.updateCursorPos(t),this.$elm.attr("title",""),"focus"==this.opts.showOn||void this.showDelayed())},mouseleave:function(t){if(this.disabled||this.asyncAnimating&&(this.$tip[0]===t.relatedTarget||jQuery.contains(this.$tip[0],t.relatedTarget)))return!0;if(!this.$tip.data("active")){var i=this.$elm.data("title.poshytip");null!==i&&this.$elm.attr("title",i)}return"focus"==this.opts.showOn||void this.hideDelayed()},mousemove:function(t){return!!this.disabled||(this.updateCursorPos(t),void(this.opts.followCursor&&this.$tip.data("active")&&(this.calcPos(),this.$tip.css({left:this.pos.l,top:this.pos.t}))))},show:function(){this.disabled||this.$tip.data("active")||(this.reset(),this.update(),this.content&&(this.display(),this.opts.timeOnScreen&&this.hideDelayed(this.opts.timeOnScreen)))},showDelayed:function(t){this.clearTimeouts(),this.showTimeout=setTimeout($.proxy(this.show,this),"number"==typeof t?t:this.opts.showTimeout)},hide:function(){!this.disabled&&this.$tip.data("active")&&this.display(!0)},hideDelayed:function(t){this.clearTimeouts(),this.hideTimeout=setTimeout($.proxy(this.hide,this),"number"==typeof t?t:this.opts.hideTimeout)},reset:function(){this.$tip.queue([]).detach().css("visibility","hidden").data("active",!1),this.$inner.find("*").poshytip("hide"),this.opts.fade&&this.$tip.css("opacity",this.opacity),this.asyncAnimating=!1},update:function(t,i){if(!this.disabled){var s=void 0!==t;if(s){if(i||(this.opts.content=t),!this.$tip.data("active"))return}else t=this.opts.content;var e=this,o="function"==typeof t?t.call(this.$elm[0],function(t){e.update(t)}):"[title]"==t?this.$elm.data("title.poshytip"):t;this.content!==o&&(this.$inner.empty().append(o),this.content=o),this.refresh(s)}},refresh:function(t){if(!this.disabled){if(t){if(!this.$tip.data("active"))return;var i={left:this.$tip.css("left"),top:this.$tip.css("top")}}if(this.$tip.css({left:0,top:0}).appendTo(document.body),void 0===this.opacity&&(this.opacity=this.$tip.css("opacity")),this.tipOuterW=this.$tip.outerWidth(),this.tipOuterH=this.$tip.outerHeight(),this.calcPos(),this.pos.arrow){this.$tip.removeClass("left right top bottom");var s={left:"right",top:"bottom",right:"left",bottom:"top"};this.$tip.addClass(s[this.pos.arrow])}if(t&&this.opts.refreshAniDuration){this.asyncAnimating=!0;this.$tip.css(i).css({left:this.pos.l,top:this.pos.t}).show()}else this.$tip.css({left:this.pos.l,top:this.pos.t})}},display:function(t){var i=this.$tip.data("active");if(!(i&&!t||!i&&t)){if(this.$tip.stop(),(this.opts.slide&&this.pos.arrow||this.opts.fade)&&(t&&this.opts.hideAniDuration||!t&&this.opts.showAniDuration)){var s={},e={};if(this.opts.slide&&this.pos.arrow){var o,h;"bottom"==this.pos.arrow||"top"==this.pos.arrow?(o="top",h="bottom"):(o="left",h="right");var p=parseInt(this.$tip.css(o));s[o]=p+(t?0:this.pos.arrow==h?-this.opts.slideOffset:this.opts.slideOffset),e[o]=p+(t?this.pos.arrow==h?this.opts.slideOffset:-this.opts.slideOffset:0)+"px"}this.opts.fade&&(s.opacity=t?this.$tip.css("opacity"):0,e.opacity=t?0:this.opacity),this.$tip.css(s).animate(e,this.opts[t?"hideAniDuration":"showAniDuration"])}if(t?this.$tip.queue($.proxy(this.reset,this)):this.$tip.css("visibility","inherit"),i){var r=this.$elm.data("title.poshytip");null!==r&&this.$elm.attr("title",r)}this.$tip.data("active",!i)}},disable:function(){this.reset(),this.disabled=!0},enable:function(){this.disabled=!1},destroy:function(){this.reset(),this.$tip.remove(),delete this.$tip,this.content=null,this.$elm.unbind(".poshytip").removeData("title.poshytip").removeData("poshytip"),s.splice($.inArray(this,s),1)},clearTimeouts:function(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=0),this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=0)},updateCursorPos:function(t){this.eventX=t.pageX,this.eventY=t.pageY},calcPos:function(){var t,i,s,e,o,h,p={l:0,t:0,arrow:""},r=$(window),n={l:r.scrollLeft(),t:r.scrollTop(),w:r.width(),h:r.height()};if("cursor"==this.opts.alignTo)t=i=s=this.eventX,e=o=h=this.eventY;else{var a=this.$elm.offset(),l={l:a.left,t:a.top,w:this.$elm.outerWidth(),h:this.$elm.outerHeight()};t=l.l+("inner-right"!=this.opts.alignX?0:l.w),i=t+Math.floor(l.w/2),s=t+("inner-left"!=this.opts.alignX?l.w:0),e=l.t+("inner-bottom"!=this.opts.alignY?0:l.h),o=e+Math.floor(l.h/2),h=e+("inner-top"!=this.opts.alignY?l.h:0)}switch(this.opts.alignX){case"right":case"inner-left":p.l=s+this.opts.offsetX,this.opts.keepInViewport&&p.l+this.tipOuterW>n.l+n.w&&(p.l=n.l+n.w-this.tipOuterW),"right"!=this.opts.alignX&&"center"!=this.opts.alignY||(p.arrow="left");break;case"center":p.l=i-Math.floor(this.tipOuterW/2),this.opts.keepInViewport&&(p.l+this.tipOuterW>n.l+n.w?p.l=n.l+n.w-this.tipOuterW:p.l<n.l&&(p.l=n.l));break;default:p.l=t-this.tipOuterW-this.opts.offsetX,this.opts.keepInViewport&&p.l<n.l&&(p.l=n.l),"left"!=this.opts.alignX&&"center"!=this.opts.alignY||(p.arrow="right")}switch(this.opts.alignY){case"bottom":case"inner-top":p.t=h+this.opts.offsetY,p.arrow&&"cursor"!=this.opts.alignTo||(p.arrow="top"),this.opts.keepInViewport&&p.t+this.tipOuterH>n.t+n.h&&(p.t=e-this.tipOuterH-this.opts.offsetY,"top"==p.arrow&&(p.arrow="bottom"));break;case"center":p.t=o-Math.floor(this.tipOuterH/2),this.opts.keepInViewport&&(p.t+this.tipOuterH>n.t+n.h?p.t=n.t+n.h-this.tipOuterH:p.t<n.t&&(p.t=n.t));break;default:p.t=e-this.tipOuterH-this.opts.offsetY,p.arrow&&"cursor"!=this.opts.alignTo||(p.arrow="bottom"),this.opts.keepInViewport&&p.t<n.t&&(p.t=h+this.opts.offsetY,"bottom"==p.arrow&&(p.arrow="top"))}this.pos=p}},$.fn.poshytip=function(t){if("string"==typeof t){var i=arguments,s=t;return Array.prototype.shift.call(i),"destroy"==s&&(this.die?this.die("mouseenter.poshytip").die("focus.poshytip"):$(document).undelegate(this.selector,"mouseenter.poshytip").undelegate(this.selector,"focus.poshytip")),this.each(function(){var t=$(this).data("poshytip");t&&t[s]&&t[s].apply(t,i)})}var e=$.extend({},$.fn.poshytip.defaults,t);if(e.liveEvents&&"none"!=e.showOn){var o,h=$.extend({},e,{liveEvents:!1});switch(e.showOn){case"hover":o=function(){var t=$(this);t.data("poshytip")||t.poshytip(h).poshytip("mouseenter")},this.live?this.live("mouseenter.poshytip",o):$(document).delegate(this.selector,"mouseenter.poshytip",o);break;case"focus":o=function(){var t=$(this);t.data("poshytip")||t.poshytip(h).poshytip("showDelayed")},this.live?this.live("focus.poshytip",o):$(document).delegate(this.selector,"focus.poshytip",o)}return this}return this.each(function(){new $.Poshytip(this,e)})},$.fn.poshytip.defaults={content:"[title]",className:"tip-yellow",idName:"",showTimeout:500,hideTimeout:100,timeOnScreen:0,showOn:"hover",liveEvents:!1,alignTo:"cursor",alignX:"right",alignY:"top",offsetX:-22,offsetY:18,keepInViewport:!0,allowTipHover:!0,followCursor:!1,fade:!0,slide:!0,slideOffset:8,showAniDuration:300,hideAniDuration:300,refreshAniDuration:200}});
define("ui.dialog",function(o){var e=o("artdialog");return function(o,i){function n(o){window.clearTimeout(c),"function"==typeof i&&i(o)}function t(o){return'<table class="ui-dialog-table" align="center"><tr><td valign="middle"><div class="iPHP-msg"><span class="label label-'+a.label+'"><i class="fa fa-'+a.icon+'"></i> '+o+"</span></div></td></tr></table>"}var l={id:"iCMS-DIALOG",title:"iCMS - 提示信息",className:"iCMS_UI_DIALOG",backdropBackground:"#333",backdropOpacity:.5,fixed:!0,autofocus:!1,quickClose:!0,lock:!0,time:null,label:"success",icon:"check",api:!1,width:360,height:120},c=null,a=$.extend(l,iCMS.CONFIG.DIALOG,o);console.log(a),a.follow&&(a.fixed=!1,a.lock=!1,a.skin="iCMS_tooltip_popup",a.className="ui-popup",a.backdropOpacity=0);var s=a.content;s instanceof jQuery?a.content=s:"string"==typeof s&&(a.content=t(s)),a.onclose=function(){n("close")},a.onbeforeremove=function(){n("beforeremove")},a.onremove=function(){n("remove")};var r=e(a);return a.lock?r.showModal():(r.show(a.follow),a.follow),a.time&&(c=window.setTimeout(function(){r.destroy()},a.time)),r.destroy=function(){r.close().remove()},r}});
define("ui",{widget:{ucard:['<div class="tip_info">','<img src="'+require("config").PUBLIC+'/ui/loading.gif">',"<span> 用户信息加载中……</span>","</div>"].join("")},dialog:function(i){var e=require("ui.dialog");return e(i)},alert:function(i,e,n){var c=require("ui.dialog"),r=e?{label:"success",icon:"check"}:{label:"warning",icon:"warning"};r.id="iCMS-DIALOG-ALERT",r.skin="iCMS_dialog_alert",r.content=i,r.time=3e3,r.lock=!0,c(r,n)},seccode:function(i,e){var n=require("api"),i=i||".seccode-img",e=e||"body";$(i,e).attr("src",n.url("public","&do=seccode&")+Math.random())}});
define("utils",{addcss:function(e,r){e=iCMS.CONFIG.PUBLIC+"/"+e;var a=document.createElement("link"),l=document.getElementsByTagName("head")[0];a.id=r,a.href=e,a.type="text/css",a.rel="stylesheet",l.insertBefore(a,l.firstChild)},addjs:function(e,r){url=iCMS.CONFIG.PUBLIC+"/"+e+".js";var a=document.createElement("script"),l=document.getElementsByTagName("head")[0];a.id=r,a.src=url,l.insertBefore(a,l.firstChild)},$:function(e){var r=$(document);return r.find("[iCMS="+e+"]")},format:function(e,r){function a(e,r){for(var a="",l=e.split("[iCMS.N]"),i=0;i<l.length;i++){for(;" "==l[i].substr(0,1)||"　"==l[i].substr(0,1);)l[i]=l[i].substr(1,l[i].length);l[i].length>0&&(a+=r?l[i]+"\n":"<p>"+l[i]+"</p>")}return a}return e=e.replace(/\/"/g,'"').replace(/\\\&quot;/g,"").replace(/\r/g,"").replace(/on(\w+)="[^"]+"/gi,"").replace(/<script[^>]*?>(.*?)<\/script>/gi,"").replace(/<style[^>]*?>(.*?)<\/style>/gi,"").replace(/style=[" ]?([^"]+)[" ]/gi,"").replace(/<a[^>]+href=[" ]?([^"]+)[" ]?[^>]*>(.*?)<\/a>/gi,"[url=$1]$2[/url]").replace(/<img[^>]+src=[" ]?([^"]+)[" ]?[^>]*>/gi,"[img]$1[/img]").replace(/<embed/g,"\n<embed").replace(/<embed[^>]+class="edui-faked-video"[^"].+src=[" ]?([^"]+)[" ]+width=[" ]?([^"]\d+)[" ]+height=[" ]?([^"]\d+)[" ]?[^>]*>/gi,"[video=$2,$3]$1[/video]").replace(/<embed[^>]+class="edui-faked-music"[^"].+src=[" ]?([^"]+)[" ]+width=[" ]?([^"]\d+)[" ]+height=[" ]?([^"]\d+)[" ]?[^>]*>/gi,"[music=$2,$3]$1[/music]").replace(/<b[^>]*>(.*?)<\/b>/gi,"[b]$1[/b]").replace(/<strong[^>]*>(.*?)<\/strong>/gi,"[b]$1[/b]").replace(/<p[^>]*?>/g,"\n\n").replace(/<br[^>]*?>/g,"\n").replace(/<li[^>]*?>/g,"\n").replace(/<[^>]*?>/g,""),r?(e=e.replace(/\n+/g,"[iCMS.N]"),e=a(e,r)):(e=e.replace(/\[url=([^\]]+)\]\n(\[img\]\1\[\/img\])\n\[\/url\]/g,"$2").replace(/\[img\](.*?)\[\/img\]/gi,'<p><img src="$1" /></p>').replace(/\[b\](.*?)\[\/b\]/gi,"<b>$1</b>").replace(/\[url=([^\]|#]+)\](.*?)\[\/url\]/g,"$2").replace(/\[url=([^\]]+)\](.*?)\[\/url\]/g,'<a target="_blank" href="$1">$2</a>').replace(/\n+/g,"[iCMS.N]"),e=a(e),e=e.replace(/#--iCMS.PageBreak--#/g,"<!---->#--iCMS.PageBreak--#").replace(/<p>\s*<p>/g,"<p>").replace(/<\/p>\s*<\/p>/g,"</p>").replace(/<p>\s*<\/p>/g,"").replace(/\[video=(\d+),(\d+)\](.*?)\[\/video\]/gi,'<embed type="application/x-shockwave-flash" class="edui-faked-video" pluginspage="http://www.macromedia.com/go/getflashplayer" src="$3" width="$1" height="$2" wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true"/>').replace(/\[music=(\d+),(\d+)\](.*?)\[\/music\]/gi,'<embed type="application/x-shockwave-flash" class="edui-faked-music" pluginspage="http://www.macromedia.com/go/getflashplayer" src="$3" width="$1" height="$2" wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" align="none"/>').replace(/<p><br\/><\/p>/g,""))},random:function(e){e=e||16;var r="abcdefhjmnpqrstuvwxyz23456789ABCDEFGHJKLMNPQRSTUVWYXZ",a="";for(i=0;i<e;i++)a+=r.charAt(Math.floor(Math.random()*r.length));return a},callback:function(e,r,a,l,i){var c=r||l.SUCCESS,t=a||l.FAIL;e.code?this.__callback(c,e,i):this.__callback(t,e,i)},__callback:function(e,r,a){if("function"==typeof e)e(r,a);else{var l=r;"object"==typeof r&&(l=r.msg||"error");var i=require("ui");i.alert(l)}}});
define("user",function(e){var t=e("utils"),n=e("api"),o={};return $.extend(o,{NOAVATAR:function(e){e.src=iCMS.CONFIG.PUBLIC+"/ui/avatar.gif"},NOCOVER:function(e,t){var n="coverpic";"m"==t&&(n="m_coverpic"),e.src=iCMS.CONFIG.PUBLIC+"/ui/"+n+".jpg"},STATUS:function(e,i,a){var r=this;$.get(n.url("user","&do=data"),e,function(e){e.code&&(o.data=e),t.callback(e,i,a,r)},"json")},AUTH:function(){var t=e("cookie");return!!t.get(iCMS.CONFIG.AUTH)},LOGIN:function(){},LOGOUT:function(e,o,i){var a=this;$.get(n.url("user","&do=logout"),e,function(e){t.callback(e,o,i,a)},"json")},FOLLOW:function(e,o,i){var a=this,r=this.AUTH();if(!r)return this.LOGIN();var c=$(e).attr("i").replace("follow:","").split(":"),u={uid:c[0],follow:c[1],action:"follow"};$.post(n.url("user"),u,function(e){t.callback(e,o,i,a,u)},"json")},UCARD:function(){var t=e("ui");e("poshytip");$("[i^='ucard']").poshytip({idName:"iCMS-UCARD",className:"iCMS_UI_TOOLTIP",alignTo:"target",alignX:"center",offsetX:0,offsetY:5,fade:!1,slide:!1,content:function(e){var o=$(this).attr("i").replace("ucard:","");return o&&$.get(n.url("user","&do=ucard"),{uid:o},e),t.widget.ucard}})},PM:function(t){var o=this.AUTH();if(!o)return this.LOGIN();var i=e("ui"),a=$(t),r=document.getElementById("iCMS-PM-DIALOG"),c=i.dialog({title:"发送私信",quickClose:!1,width:"auto",height:"auto",content:r}),u=a.attr("href"),l=n.param(t),s=$("[name='content']",r).val("");$(".pm_warnmsg",r).hide(),$(".pm_uname",r).text(l.name),u?$(".pm_inbox",r).attr("href",u):$(".pm_inbox",r).hide(),$(".cancel",r).click(function(e){e.preventDefault(),c.remove()}),$('[name="send"]',r).click(function(e){return e.preventDefault(),l.content=s.val(),l.content?(l.action="pm",void $.post(n.url("user"),l,function(e){c.remove(),i.alert(e.msg,e.code)},"json")):(s.focus(),$(".pm_warnmsg",r).show(),!1)})},REPORT:function(t){var o=this.AUTH();if(!o)return this.LOGIN();var i=e("ui"),a=$(t),r=a.attr("title")||"为什么举报这个评论?",c=document.getElementById("iCMS-REPORT-DIALOG"),u=i.dialog({title:r,content:c,quickClose:!1,width:"auto",height:"auto"});$("li",c).click(function(e){e.preventDefault(),$("li",c).removeClass("checked"),$(this).addClass("checked"),$("[name='reason']",this).prop("checked",!0)}),$(".cancel",c).click(function(e){e.preventDefault(),u.remove()}),$('[name="ok"]',c).click(function(e){e.preventDefault();var t=n.param(a),o=$("[name='content']",c);return t.reason=$("[name='reason']:checked",c).val(),t.reason?"0"!=t.reason||(t.content=o.val(),t.content)?(t.action="report",void $.post(n.url("user"),t,function(e){o.val(""),$("li",c).removeClass("checked"),$("[name='reason']",c).removeAttr("checked"),i.alert(e.msg,e.code),e.code&&u.remove()},"json")):(i.alert("请填写举报的原因"),!1):(i.alert("请选择举报的原因"),!1)})}})});
define("passport",function(t){var n=t("api");return{SUCCESS:{},FAIL:{},__post:function(t){var c=this;$.post(n.url("user"),t,function(t){c.__callback(t)},"json")},__callback:function(n,c,i){var o=t("utils");o.callback(n,c,i,this)},LOGIN:function(t){t=$.extend(t,{action:"login"}),this.__post(t)},REGISTER:function(t){t=$.extend(t,{action:"register"}),this.__post(t)},CHECK:function(t,c,i){var o=this;$.get(n.url("user","&do=check"),t,function(t){o.__callback(t,c,i)},"json")}}});
window.iCMS={version:"6.2.0",plugins:{},modules:{},data:{},UI:{},API:require("api"),init:function(i){var e=require("config");iCMS.CONFIG=$.extend(e,i),iCMS.CONFIG.API=iCMS.CONFIG.PUBLIC+"/api.php",iCMS.UI=require("ui"),iCMS.dialog=iCMS.UI.dialog,iCMS.alert=iCMS.UI.alert},run:function(i,e){var r=require(i);return"function"==typeof e?e(r):r}};

})(jQuery)