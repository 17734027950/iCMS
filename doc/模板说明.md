##网站模板系统

### 模板文件及目录结构
```
/template [模板目录]
 ├─default ------------------[默认模板]
 │   article.htm ------------[内容页]
 │   article.up_down.htm ----[内容顶踩功能]
 │   category.index.htm -----[栏目首页]
 │   category.list.htm ------[栏目列表页]
 │   footer.htm -------------[页脚]
 │   header.htm -------------[页头]
 │   index.htm --------------[首页]
 │   public.ui.htm ----------[UI资源]
 │   search.htm -------------[搜索结果页]
 │   tag.index.htm ----------[标签页]
 ├─iCMS ---------------------[系统模板]
 │ │ agreement.htm ----------[服务协议]
 │ │ public.common.htm ------[系统通用页]
 │ │ public.dialog.htm ------[系统对话框]
 │ │ public.ui.htm  ---------[系统UI]
 │ │ sitemap.baidu.htm ------[百度站长平台sitemap模板]
 │ │ sitemap.index.htm ------[百度站长平台sitemap index模板]
 │ │ weixin.api.htm ---------[微信公众平台接口]
 │ ├─comment ----------------[系统评论模板目录]
 │ │   api.json.htm ---------[评论JSON]
 │ │   form.default.htm -----[评论框]
 │ │   form.iframe.htm ------[评论框-框架调用]
 │ │   list.default.htm -----[评论列表模板]
 │ │   list.iframe.htm ------[评论列表模板-框架调用]
 │ └─user  ------------------[用户模板目录]
 │   │ card.htm -------------[用户名片对话框]
 │   │ footer.htm -----------[用户通用页脚]
 │   │ home.article.htm -----[用户主页文章列表]
 │   │ home.favorite.htm ----[用户主页文章列表]
 │   │ home.htm -------------[用户主页]
 │   │ login.close.htm ------[关闭登陆]
 │   │ login.htm ------------[登陆页]
 │   │ manage.htm -----------[用户内容管理页]
 │   │ menu.htm -------------[下拉菜单]
 │   │ profile.htm ----------[用户资料管理页]
 │   │ register.close.htm ---[注册关闭页]
 │   │ register.htm ---------[注册页]
 │   ├─manage ---------------[用户内容管理目录]
 │   │   article.htm --------[用户文章管理]
 │   │   category.htm -------[用户栏目管理]
 │   │   comment.htm  -------[用户评论管理]
 │   │   fans.htm  ----------[用户粉丝管理]
 │   │   favorite.htm  ------[用户收藏管理]
 │   │   follow.htm ---------[用户关注管理]
 │   │   inbox.htm  ---------[用户信息管理]
 │   │   publish.htm  -------[用户文章发布]
 │   └─profile --------------[用户资料管理目录]
 │       avatar.htm ---------[用户头像上传]
 │       base.htm -----------[用户基本信息]
 │       bind.htm -----------[用户绑定开放平台]
 │       custom.htm ---------[用户主页封面]
 │       setpassword.htm ----[用户密码修改]
 ├─mobile -------------------[手机版模板 同默认模板]
 │ │ article.htm
 │ │ category.index.htm
 │ │ category.list.htm
 │ │ footer.htm
 │ │ index.htm
 │ │ navbar.htm
 │ │ public.common.htm
 │ │ public.ui.htm
 │ │ search.htm
 │ │ tag.index.htm
 │ └─user -------------------[手机版用户模板 同iCSM下的user模板]
 │   │ home.htm
 │   │ login.close.htm
 │   │ login.htm
 │   │ manage.htm
 │   │ menu.htm
 │   │ navbar.htm
 │   │ profile.htm
 │   │ register.close.htm
 │   │ register.htm
 │   ├─manage
 │   │   article.htm
 │   │   category.htm
 │   │   comment.htm
 │   │   inbox.htm
 │   │   publish.htm
 │   └─profile
 │       avatar.htm
 │       base.htm
 │       bind.htm
 │       custom.htm
 │       setpassword.htm
 └─weixin -------------------[微信端模板 同默认模板]
    article.htm
    category.index.htm
    category.list.htm
    footer.htm
    index.htm
    navbar.htm
    tag.index.htm
```
*以上是系统默认的模板命名,除了 iCMS [系统模板] 和 user [用户模板] 外其它模板可以随意命名*

iCMS [系统模板]
*说明：在没有指定的默认底层模板的时候，系统将自动调用这个文件夹的相应文件作为底层模板*
*如果无相关系统模板 默认优化级 为 设备模板-> 手机模板-> 桌面模板*


##模板标记简介
iCMS 使用了Smarty简化版的template_lite模板引擎,并做了相关的优化

##模板标记样式
有如下几种形式
```
<!--{$变量名称}-->

<!--{$变量名称.属性}-->

<!--{iCMS:函数 属性='值'}-->

<!--{iCMS:应用名:函数 属性='值'}-->

<!--{iCMS:应用名:函数 loop='循环标示符' 属性='值'}-->

    <!--{$变量名称(应用名_函数).属性}-->

<!--{/iCMS}-->
```
**标记允许在任何以$开头的标记中使用调节器对得到的值进行处理，形式为：**
```
<!--{$变量名称|modifiers}--> //其中modifiers可带参数
例:
<!--{$site.title|upper}--> 将标记的值改为大写
<!--{$site.title|default:"参数"}--> 当标记的值为空时用参数填充
```
##基本语法
判断
模板文件中可以使用if else等判断语句
"**==**","**!=**","**>**","**<**","**<=**","**>=**"
这些是if中可以用到的比较。看看就能知道什么意思吧。
```
<!--{if $name=="iCMS"}-->
    Hello World
<!--{elseif $name=="idreamsoft"}-->
    idreamsoft.com
<!--{else}-->
    Welcome
<!--{/if}-->
```
循环遍历数组 foreach

foreach 必须和 /foreach 成对使用，且必须指定 from 和 value 属性。

```
<!--{foreach key=key value=alist from="$article_list"}-->
    <!--{$alist.title}-->
<!--{/foreach}-->
```

##iCMS模板标签
###系统信息
```
<!--{$iCMS}-->
```
**$iCMS 可用属性** *注意大小写*
```
Array(
  [VERSION] => iCMS 版本
  [MOBILE] => 是否手机端
  [API] =>  系统API接口网址
  [UI] => 系统UI目录
  [UI_URL] => 系统UI目录 网址
  [SAPI] => 当前应用URL
  [COOKIE_PRE] => cookies前缀
  [REFER] => 访问来路
  [CONFIG] => 系统配置 (array)
  [APP] => array( //当前应用
      [NAME] => 当前应用名
      [DO] => 当前应用请求的方法名
      [METHOD] => 当前应用请求的方法
  )
 [APPID] => array(//应用ID
      [ARTICLE] => int 1
      [CATEGORY] => int 2
      [TAG] => int 3
      [PUSH] => int 4
      [COMMENT] => int 5
      [PROP] => int 6
      [MESSAGE] => int 7
      [FAVORITE] => int 8
      [USER] => int 9
  )
)
```
**调用方式**
```
例:
iCMS版本:<!--{$iCMS.VERSION}-->
系统API接口网址:<!--{$iCMS.API}-->
当前应用名:<!--{$iCMS.APP.NAME}-->
```
-----
###站点信息
```
<!--{$site}-->
```
**$site 可用属性**
```
Array(
    [name] => 网站名称
    [seotitle] => 网站标题
    [keywords] => 关键字
    [description] => 网站描述
    [icp] => 备案号
    [title] => 网站名称 (name的别名)
    [404] => 404页面 网址
    [url] => 网站网址
    [tpl] => 桌面端模板目录
    [urls] => Array(
            [public] => 公共资源URL
            [user] => 用户URL
            [res] => 附件URL
            [ui] => 系统UI URL
            [avatar] => 用户头像URL
        )
)
```
**调用方式**
例如:
```
网站名称:<!--{$site.name}-->
公共资源URL:<!--{$site.urls.public}-->
```

###文章列表
```
<!--{iCMS:article:list
loop="true"
row="10"
cid="1" cid!="1"
pid="1"
startdate=""
enddate=""
pic="true"
by="ASC|DESC"
orderby="hot"
keywords=""
id="1" id!="1"
cache="true"
cids=""
pids=""
tids=""
userid=""
ucid=""
weight=""
status=""
call="user|admin"
nopic="true"
where=""
as=""

start="0"
step=""
max=""
}-->
内部变量 *为系统变量
* <!--{$article_list.total}-->    //总条数
* <!--{$article_list.prev}-->     //上一条行号 (从1开始)
* <!--{$article_list.next}-->     //下一条行号 (从1开始)
* <!--{$article_list.rownum}-->   //行号 (从1开始)
* <!--{$article_list.index}-->    //索引号 (从0开始)
* <!--{$article_list.first}-->    //第一条为true 否则flase
* <!--{$article_list.last}-->     //最后一条为true 否则flase

<!--{$article_list.title}-->        //文章标题
<!--{$article_list.url}-->          //文章网址
<!--{$article_list.description}-->  //文章简介
<!--{$article_list.pubdate}-->      //文章发布时间戳
<!--{$article_list.pubdate|date:'Y-m-d'}-->

<!--{$article_list|print_r}-->      //查看所有内部变量

<!--{/iCMS}-->
```
####属性介绍
|属性|可选值|说明
|-|-|-|
|loop|true|循环标记
|row|10|返回行数
|cid|1｜1,2,3|栏目ID,多项请用**,**隔开
|cid!|1｜1,2,3|排除的栏目ID,多项请用**,**隔开
|pid|1｜1,2,3|属性ID,多项请用**,**隔开
|startdate|20150101,-1,-15|指定开始时间,-1=1天前,-15=15天前,以此类推
|enddate|20150101,1,15|指定结束时间,1=1天后,15=15天后,以此类推
|pic|true|有缩略图的文章
|by|ASC｜DESC|排序方式 默认值DESC, ASC 从小到大  DESC从大到小
|orderby|hot,week,month,comment,pubdate,disorder,weight|排序方法 hot 总点击 ,week 周点击,month 月点击,comment 评论数,pubdate 发布时间  disorder 文章的排序 weight 权重
|keywords|关键词|在(title,keywords,description)搜索关键词,数据量大时 请使用 sphinx
|id|文章ID|指定文章ID
|id!|文章ID|排除文章ID
|cache|true|启用缓存
|cids|栏目ID｜1,2,3|副栏目的ID,多项请用**,**隔开
|pids|属性值｜1,2,3|属性值,多项请用**,**隔开
|tids|标签ID｜1,2,3|标签ID,多项请用**,**隔开
|userid|用户ID|
|call|user,admin|文章用户类型
|weight|权重|文章的权重
|nopic|true|无缩略图
|where|SQL语句|如果你觉得上面的条件不够用,那自己写吧
|start|0|开始索引号
|step|步进值|
|max|最大索引值


####常用示例
```
<!--{iCMS:article:list loop="true" row="10" orderby="hot" cid="1"}-->
获取 栏目ID 为 1 按总点击 从大到小 排序的文章 10条
<!--{/iCMS}-->
```
```
<!--{iCMS:article:list loop="true" row="10" orderby="week" cid="$category.cid"}-->
获取 [$category.cid] 变量为栏目ID 按周点击 从大到小 排序的文章 10条
<!--{/iCMS}-->
```
